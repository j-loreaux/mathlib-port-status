{% extends "layout.j2" %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{site_url}}/hljs-light.css">
<link rel="stylesheet" href="{{site_url}}/hljs-dark.css">
<script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.7.0/build/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
{% endblock %}

{%block title %}{{mathlib3_import|join('.')}} | {{super()}}{% endblock %}

{% block body %}

<h1>
    <a href="https://leanprover-community.github.io/mathlib_docs/{{mathlib3_import|join('/')}}"><code>{{mathlib3_import|join('.')}}</code></a> ‚ü∑
    {% if data.status.ported %}
    <a href="https://leanprover-community.github.io/mathlib4_docs/{{mathlib4_import|join('/')}}"><code>{{mathlib4_import|join('.')}}</code></a>
    {% elif mathlib4_import is not none %}
    <code class="text-muted">{{mathlib4_import|join('.')}}</code>
    {% else %}?{% endif %}</a>
</h1>
{% if data.state == PortState.PORTED%}
<div class="alert alert-success">This file has been ported!</div>
{% elif data.state == PortState.IN_PROGRESS %}
<div class="alert alert-warning">This file is currently being ported at <a href="https://github.com/leanprover-community/mathlib4/pull/{{data.status.mathlib4_pr}}">#{{data.status.mathlib4_pr}}</a>.</div>
{% endif %}
{% if data.status.comment.message is not none %}
<p>Before working on this file, consider the following:</p>
<figure>
  <blockquote class="blockquote">
    <p>{{ data.status.comment.message | htmlify_comment }}</p>
  </blockquote>
  <figcaption class="blockquote-footer">
    From <a href="https://github.com/leanprover-community/mathlib4/wiki/port-comments">the port comment wiki</a>
  </figcaption>
</figure>
{% endif %}
<script>
var range = new URLSearchParams(window.location.search).get('range');
if (range != null) {
    let [base, head] = range.split('..', 2);
    document.currentScript.insertAdjacentElement('beforebegin',
    $('<div>').addClass('alert alert-info').append(
        'You arrived at this page via a link referring to ',
        $('<code>').text(base),
        "..",
        $('<code>').text(head),
        '. These commits might no longer be shown here!'
    )[0]);
}
</script>
{% if touched %}
{% set ((added, removed), diff, commits) = touched %}
<h2 id="forward-port">Changes needing forward-porting</h2>
<p>The most recent change is shown first.</p>
<ul>
    {%- for c in commits %}
        <li>
            {% set msg = c.message.split('\n', 1) %}
            <p>{{c | link_sha}}: {{msg[0] | htmlify_comment}}</p>
            {% if msg|length > 1 %}
                <pre style="white-space: pre-wrap"><code class="language-markdown">{{msg[1].strip() | htmlify_comment}}</code></pre>
            {% endif %}
        </li>
    {%- endfor %}
    <li>{{data.status.source | link_sha}} <span class="text-muted">(last sync)</span></li>
</ul>
<pre><code class="language-diff">{{ diff }}</code></pre>
{% if commits %}
<p>After forward-porting this diff, please update the SHA in the file header to <code>{{commits[0].hexsha}}</code>, and include a link to this page in the PR description to help reviewers as shown:</p>
<pre><code class="lang-markdown" style="white-space: pre-wrap">* [`{{mathlib3_import|join('.')}}`@`{{data.status.source.commit}}`..`{{commits[0].hexsha}}`]({{site_url}}/file/{{mathlib3_import|join('/')}}?range={{data.status.source.commit}}..{{commits[0].hexsha}})
</code></pre>
<p>If they exist, also link to any forward-port PRs that already forward-ported it.</p>
{% endif %}
{% endif %}

{% set parts = data.dep_counts %}
<h2>Dependencies <small>
    {%- set plus = joiner(" + ") %}
    {%- if parts[0] -%}{{ plus() }}<span class="text-danger" title="unported">{{parts[0]}}</span>{%- endif -%}
    {%- if parts[1] -%}{{ plus() }}<span class="text-warning" title="in progress">{{parts[1]}}</span>{%- endif -%}
    {%- if parts[2] -%}{{ plus() }}<span class="text-success" title="ported">{{parts[2]}}</span>{%- endif -%}
</small></h2>
<p>The unported dependencies are</p>
<ul>
    {% for d in data.dependencies|rejectattr("state", "equalto", PortState.PORTED) %}
        <li><a href="{{ site_url }}/file/{{d.mathlib3_import|join('/')}}"><code>{{d.mathlib3_import|join('.')}}</code></a></li>
    {% endfor %}
</ul>


{% endblock %}
